<source>
  @type dummy
  dummy {"message": "{\"sample\": \"This is a dummy log entry.\"}"}
  tag mytag
</source>

<match mytag>
  @type azurestorage_gen2
  azure_storage_account            mystorageabfs
  azure_container                  mycontainer
  azure_instance_msi               /subscriptions/mysubscriptionid
  azure_client_id                  <msi client id>
  azure_object_key_format          %{path}-%{index}.%{file_extension}
  azure_oauth_refresh_interval     3600
  time_slice_format                %Y%m%d-%H
  file_extension                   log # only used with store_as none
  path                             "/cluster-logs/myfolder/${tag[1]}-#{Socket.gethostname}-%M"
  auto_create_container            true
  store_as                         parquet
  format                           single_value
  local_testing                    true
  local_testing_folder             /fluentd/test
  <compress>
    parquet_compression_codec uncompressed
    schema_file /fluentd/etc/schema.avsc
    record_type json
  </compress>                 
  <buffer tag,time>
    @type file
    path /var/log/fluent/azurestorage-buffer
    timekey 10s
    timekey_wait 0s
    timekey_use_utc true
    chunk_limit_size 64m
  </buffer>
</match>
